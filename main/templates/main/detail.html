{% extends 'base.html' %} 
{% load static %} 
{% block content %}
<head>
	<style>
		body{
				background-color: #b8b2ec;
			}
	</style>
</head>

<h1>{{post.title}} </h1>
<div style=" text-indent: 15px;">
  {%Â ifÂ post.writerÂ %}
    {%Â ifÂ 'user'Â inÂ post.writer.usernameÂ %}
    ì‘ì„±ìÂ :Â <a href="{% url 'users:mypage' post.writer.id %}"></a>{{Â post.writer.last_nameÂ }}Â {{Â post.writer.first_nameÂ }}
    {%Â elseÂ %}
    ì‘ì„±ìÂ :Â <a href="{% url 'users:mypage' post.writer.id %}"></a>{{Â post.writerÂ }}
    {%Â endifÂ %}
    {%Â elseÂ %}
    ì‘ì„±ìÂ :Â ì•ŒÂ ìˆ˜Â ì—†ìŒ
  {%Â endifÂ %}
</div>
 
<div style=" text-indent: 15px;">
  ë‚ ì§œ : {{post.pub_date}}
</div> 
<hr/>

{% if post.image %}
<!-- ì—¬ê¸° ìˆ˜ì • -->
<p>
  <img src="{{ post.image.url }}" alt="ì‚¬ì§„" />
</p>
{% endif %}

<p style=" text-indent: 30px;">{{post.body}}</p>
<script src="https://kit.fontawesome.com/016d3d09d8.js" crossorigin="anonymous"></script>

<div class="heart">
	<span href="#" class="like" name ="{{post.id}}" value="Like"> 

		<!-- ë§Œì•½ ìœ ì €ê°€ ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ë‹¤ë©´ ì±„ìš´ í•˜íŠ¸ë¡œ ë³€ê²½-->
		{% if user in post.like_user_set.all %}
			<div class="alt-service-icon">
				<i class="fas fa-heart" id ="like-icon" style="color:red;"></i>
			</div> 
		<!-- ì•„ë‹ˆë©´ ë¹„ì›Œì§„ í•˜íŠ¸-->         
		{% else %}

			<div class="alt-service-icon">
				<i class="far fa-heart" id ="like-icon" style="color:red;"></i> 
			</div>

		{% endif %}

		<span id="count-{{ post.id }}" class="alt-services-title font-alt"> 
			ì¢‹ì•„ìš” 
			{% if post.like_count == 0 %} 
				0ê°œ 
			{% else %}
				{{ post.like_count }}ê°œ
			{% endif %}
		</span>
	</span>

	</div>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

	<script>
		$(".like").click(function(){
			var pk = $(this).attr('name')
			$.ajax({
				url : "{% url 'main:like_toggle' post.pk %}",
				data : {'pk':pk,'csrfmiddlewaretoken': '{{ csrf_token }}'},
				type:"POST",
				dataType:"json",
				
				success: function(response){

					if (response.like_count==null){
						alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
						window.location.replace('/accounts/login/')
					}
					else{
						if (response.result == "like"){
							$('#like-icon').removeClass();
							$('#like-icon').addClass('fas fa-heart');
						}
						else{
							$('#like-icon').removeClass();
							$('#like-icon').addClass('far fa-heart');
						}

						$('#count-{{ post.id }}').html('ì¢‹ì•„ìš” '+response.like_count+'ê°œ');
					}
				},

				error: function(request, status, error){
					alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.")
					alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error); 
				},
			});
		})
	</script>

	<div class="unlike1">

		<span href="#" class="dislike" name ="{{post.id}}" value="Disike"> 

				<!-- ë§Œì•½ ìœ ì €ê°€ ì‹«ì–´ìš”ë¥¼ ëˆŒë €ë‹¤ë©´ ì±„ìš´ í•˜íŠ¸ë¡œ ë³€ê²½-->
				{% if user in post.dislike_user_set.all %}
					<div class="alt-icon">
						<i class="fas fa-heart" id ="dislike-icon" style="color:blue;"></i>
					</div> 
				<!-- ì•„ë‹ˆë©´ ë¹„ì›Œì§„ í•˜íŠ¸-->         
				{% else %}
			
					<div class="alt-icon">
						<i class="far fa-heart" id ="dislike-icon" style="color:blue;"></i> 
					</div>
			
				{% endif %}
			
				<span id="count1-{{ post.id }}" class="services-title font-alt"> 
					ì‹«ì–´ìš” 
					{% if post.dislike_count == 0 %} 
						0ê°œ 
					{% else %}
						{{ post.dislike_count }}ê°œ
					{% endif %}
				</span>
			</span>
			
	</div>
    <script>
        $(".dislike").click(function(){
            var pk = $(this).attr('name')
            $.ajax({
                url : "{% url 'main:dislike_toggle' post.pk %}",
                data : {'pk':pk,'csrfmiddlewaretoken': '{{ csrf_token }}'},
                type:"POST",
                dataType:"json",
                
                success: function(response){

                    if (response.dislike_count==null){
                        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
                        window.location.replace('/accounts/login/')
                    }
                    else{
                        if (response.result == "dislike"){
                            $('#dislike-icon').removeClass();
                            $('#dislike-icon').addClass('fas fa-heart');
                        }
                        else{
                            $('#dislike-icon').removeClass();
                            $('#dislike-icon').addClass('far fa-heart');
                        }

                        $('#count1-{{ post.id }}').html('ì‹«ì–´ìš” '+response.dislike_count+'ê°œ');
                    }
                },

                error: function(request, status, error){
                    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.")
                    alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error); 
                },
            });
        })
    </script>
			
</div>
	
<pre></pre>
<a href="{%url 'main:edit' post.id %}">âœê²Œì‹œë¬¼ ìˆ˜ì •</a><br>
<a href="{%url 'main:delete' post.id %}">ğŸ—‘ê²Œì‹œë¬¼ ì‚­ì œ</a>
<pre>


</pre>
<pre>ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤ğŸ¤</pre>
<div>
	<form action="{%url 'main:create_comment' post.id%}" method="POST">
		{%csrf_token%}
		<textarea name="content" placeholder="ëŒ“ê¸€ë‚´ìš©ì…ë ¥"></textarea>
		<input type="submit" value="í™•ì¸">
	</form>
</div>

<pre>


</pre>

<div>
{% for comment in comments %}
<pre>...................</pre>
    <div>
        <p>{%Â ifÂ post.writerÂ %}
            {%Â ifÂ 'user'Â inÂ post.writer.usernameÂ %}
            ì‘ì„±ìÂ :Â <a href="{% url 'users:mypage' comment.writer.id %}">{{Â post.writer.last_nameÂ }}{{Â post.writer.first_nameÂ }}</a>
            {%Â elseÂ %}
            ì‘ì„±ìÂ :Â <a href="{% url 'users:mypage' comment.writer.id %}">{{Â post.writerÂ }}</a>
            {%Â endifÂ %}
            {%Â elseÂ %}
            ì‘ì„±ìÂ :Â ì•ŒÂ ìˆ˜Â ì—†ìŒ
            {%Â endifÂ %}
        </p>
        <div style=" text-indent: 15px;">
          {{comment.content}}
        </div>

        <br><a href="{% url 'main:update_comment' comment.id %}">âœëŒ“ê¸€ ìˆ˜ì •</a>
        <br><a href="{% url 'main:delete_comment' comment.id %}">ğŸ—‘ëŒ“ê¸€ ì‚­ì œ </a>

    </div>

{%endfor%}
</div>


{% endblock %}


